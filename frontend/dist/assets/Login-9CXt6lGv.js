import{c as y,r as s,$ as N,d as j,j as e,f as u,u as W,_}from"./index-yVhfAtPc.js";import{C as b,a as C,b as k,c as I,d as E}from"./card-fvSyAV1p.js";import{I as v}from"./input-BRuGLdy_.js";import{C as A}from"./clock-A5PGEByJ.js";import{C as w}from"./check-circle-CjWdKTnx.js";import{R as L}from"./refresh-cw-a_RgfZ6I.js";const q=y("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),M=y("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),B=y("Github",[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]]),D=y("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),F=y("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),G=({onLoginSuccess:a})=>{const[r,h]=s.useState(null),[n,i]=s.useState(""),[o,g]=s.useState(0),{login:m}=N(),d=async()=>{try{const t=await j.post("/auth/qr/generate",{provider:"wechat"});if(!t.success)throw new Error(t.error||"生成二维码失败");if(!t.data)throw new Error("生成二维码失败：返回数据为空");h(t.data),i("等待扫码"),g(t.data.expires_in)}catch(t){console.error("生成微信二维码失败:",t),i("生成二维码失败")}};s.useEffect(()=>{if(!r)return;const t=setInterval(async()=>{try{const l=(await j.get(`/auth/qr/status/${r.qr_id}`)).data;i(p(l.status)),l.status==="confirmed"&&l.user_info?(await m(l.user_info.email,""),a==null||a(),clearInterval(t)):l.status==="expired"&&clearInterval(t)}catch(c){console.error("检查登录状态失败:",c)}},2e3);return()=>clearInterval(t)},[r,m,a]),s.useEffect(()=>{if(o<=0||!r)return;const t=setInterval(()=>{g(c=>c<=1?(clearInterval(t),i("二维码已过期"),0):c-1)},1e3);return()=>clearInterval(t)},[o,r]);const p=t=>{switch(t){case"pending":return"等待扫码";case"scanned":return"已扫码，等待确认";case"confirmed":return"登录成功";case"expired":return"二维码已过期";default:return t}};return s.useEffect(()=>{d()},[]),e.jsx("div",{className:"space-y-4",children:e.jsxs(b,{className:"bg-tech-dark border-tech-light",children:[e.jsxs(C,{className:"text-center",children:[e.jsx(k,{className:"text-xl text-green-500",children:"微信扫码登录"}),e.jsx(I,{className:"text-gray-400",children:"请使用微信扫描下方二维码"})]}),e.jsx(E,{children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[r&&e.jsx("div",{className:"p-4 bg-white rounded-lg",children:e.jsx("img",{src:r.qr_code_url,alt:"微信登录二维码",className:"w-48 h-48 object-contain"})}),e.jsxs("div",{className:"flex items-center space-x-2 text-center",children:[n==="等待扫码"&&e.jsx(A,{className:"w-4 h-4 text-gray-400"}),n==="已扫码，等待确认"&&e.jsx(w,{className:"w-4 h-4 text-yellow-500"}),n==="登录成功"&&e.jsx(w,{className:"w-4 h-4 text-green-500"}),n==="二维码已过期"&&e.jsx(q,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-sm font-medium",children:n}),o>0&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(",Math.floor(o/60),":",(o%60).toString().padStart(2,"0"),")"]})]}),e.jsxs(u,{variant:"ghost",className:"border border-tech-light hover:bg-tech-gray",onClick:d,children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"刷新二维码"]})]})})]})})},H=({onLoginSuccess:a})=>{const[r,h]=s.useState(null),[n,i]=s.useState(""),[o,g]=s.useState(0),{login:m}=N(),d=async()=>{try{const t=await j.post("/auth/qr/generate",{provider:"alipay"});if(!t.success)throw new Error(t.error||"生成二维码失败");if(!t.data)throw new Error("生成二维码失败：返回数据为空");h(t.data),i("等待扫码"),g(t.data.expires_in)}catch(t){console.error("生成支付宝二维码失败:",t),i("生成二维码失败")}};s.useEffect(()=>{if(!r)return;const t=setInterval(async()=>{try{const l=(await j.get(`/auth/qr/status/${r.qr_id}`)).data;i(p(l.status)),l.status==="confirmed"&&l.user_info?(await m(l.user_info.email,""),a==null||a(),clearInterval(t)):l.status==="expired"&&clearInterval(t)}catch(c){console.error("检查登录状态失败:",c)}},2e3);return()=>clearInterval(t)},[r,m,a]),s.useEffect(()=>{if(o<=0||!r)return;const t=setInterval(()=>{g(c=>c<=1?(clearInterval(t),i("二维码已过期"),0):c-1)},1e3);return()=>clearInterval(t)},[o,r]);const p=t=>{switch(t){case"pending":return"等待扫码";case"scanned":return"已扫码，等待确认";case"confirmed":return"登录成功";case"expired":return"二维码已过期";default:return t}};return s.useEffect(()=>{d()},[]),e.jsx("div",{className:"space-y-4",children:e.jsxs(b,{className:"bg-tech-dark border-tech-light",children:[e.jsxs(C,{className:"text-center",children:[e.jsx(k,{className:"text-xl text-blue-500",children:"支付宝扫码登录"}),e.jsx(I,{className:"text-gray-400",children:"请使用支付宝扫描下方二维码"})]}),e.jsx(E,{children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[r&&e.jsx("div",{className:"p-4 bg-white rounded-lg",children:e.jsx("img",{src:r.qr_code_url,alt:"支付宝登录二维码",className:"w-48 h-48 object-contain"})}),e.jsxs("div",{className:"flex items-center space-x-2 text-center",children:[n==="等待扫码"&&e.jsx(A,{className:"w-4 h-4 text-gray-400"}),n==="已扫码，等待确认"&&e.jsx(w,{className:"w-4 h-4 text-yellow-500"}),n==="登录成功"&&e.jsx(w,{className:"w-4 h-4 text-green-500"}),n==="二维码已过期"&&e.jsx(q,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-sm font-medium",children:n}),o>0&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(",Math.floor(o/60),":",(o%60).toString().padStart(2,"0"),")"]})]}),e.jsxs(u,{variant:"ghost",className:"border border-tech-light hover:bg-tech-gray",onClick:d,children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"刷新二维码"]})]})})]})})},X=()=>{const[a,r]=s.useState(""),[h,n]=s.useState(""),[i,o]=s.useState(""),[g,m]=s.useState(!1),[d,p]=s.useState(!1),[t,c]=s.useState("wechat"),[l,T]=s.useState(null),{login:R}=N(),S=W();s.useEffect(()=>{(()=>{const f=window.innerWidth<768,$=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return f||$})()&&m(!0)},[]);const P=async x=>{x.preventDefault(),console.log("handleLogin called with email:",a,"password:",h);try{console.log("Attempting login..."),await R(a,h),console.log("Login successful, navigating to home"),S("/")}catch(f){console.error("Login failed:",f)}},Q=async x=>{x.preventDefault(),console.log("handleRegister called with code:",i,"email:",a,"password:",h);try{console.log("Attempting registration..."),(await j.registerWithCode(i,a,h)).success&&(console.log("Registration successful, logging in..."),await R(a,h),S("/"))}catch(f){console.error("Registration failed:",f)}};return e.jsx("div",{className:"flex min-h-screen items-center justify-center p-4 bg-gradient-to-br from-tech-dark via-tech-gray to-tech-light",children:e.jsxs(b,{className:"w-full max-w-md bg-tech-dark border-tech-light",children:[e.jsxs(C,{children:[e.jsx(k,{className:"text-2xl font-bold text-center text-white",children:"农业智能平台"}),e.jsx(I,{className:"text-center text-gray-400",children:d?"使用产品注册码注册":"登录您的账户以继续"})]}),e.jsxs(E,{children:[l&&e.jsxs("div",{className:"mb-4 p-3 rounded bg-red-500/10 border border-red-500/20 text-red-500 text-sm flex items-center space-x-2",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{children:l})]}),g?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsxs(u,{variant:"ghost",className:`flex-1 ${t==="wechat"?"bg-green-600 hover:bg-green-700 text-white":"border border-tech-light"}`,onClick:()=>c("wechat"),children:[e.jsx("span",{className:"mr-2",children:"微信"}),e.jsx(M,{className:"h-4 w-4"})]}),e.jsxs(u,{variant:"ghost",className:`flex-1 ${t==="alipay"?"bg-blue-600 hover:bg-blue-700 text-white":"border border-tech-light"}`,onClick:()=>c("alipay"),children:[e.jsx("span",{className:"mr-2",children:"支付宝"}),e.jsx(M,{className:"h-4 w-4"})]})]}),t==="wechat"?e.jsx(G,{onLoginSuccess:()=>console.log("微信登录成功")}):e.jsx(H,{onLoginSuccess:()=>console.log("支付宝登录成功")}),e.jsx(u,{variant:"ghost",className:"w-full border border-tech-light hover:bg-tech-gray text-white",onClick:()=>m(!1),children:"返回账号密码登录"})]}):e.jsxs("form",{onSubmit:d?Q:P,className:"space-y-4",children:[d&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"registrationCode",className:"text-sm font-medium text-white",children:"产品注册码"}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(v,{id:"registrationCode",type:"text",placeholder:"输入您的产品注册码",value:i,onChange:x=>o(x.target.value),className:"pl-10 bg-cyber-black border-tech-light text-white",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium text-white",children:"邮箱"}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(v,{id:"email",type:"email",placeholder:"example@example.com",value:a,onChange:x=>r(x.target.value),className:"pl-10 bg-cyber-black border-tech-light text-white",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"password",className:"text-sm font-medium text-white",children:"密码"}),!d&&e.jsx("a",{href:"#",className:"text-sm text-tech-primary hover:text-tech-secondary",children:"忘记密码？"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(v,{id:"password",type:"password",placeholder:"••••••••",value:h,onChange:x=>n(x.target.value),className:"pl-10 bg-cyber-black border-tech-light text-white",required:!0})]})]}),e.jsx(u,{type:"submit",className:"w-full bg-gradient-to-r from-tech-primary to-tech-secondary hover:from-tech-primary/90 hover:to-tech-secondary/90 text-white",children:d?"注册":"登录"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-tech-light"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-tech-dark px-2 text-gray-400",children:"或者使用其他方式登录"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{variant:"ghost",className:"w-full border border-tech-light hover:bg-tech-gray text-white",onClick:()=>m(!0),children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),"扫码登录"]}),e.jsxs(u,{variant:"ghost",className:"w-full border border-tech-light hover:bg-tech-gray text-white",children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),"GitHub登录"]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(u,{variant:"link",className:"text-sm text-tech-primary hover:text-tech-secondary",onClick:()=>p(!d),children:d?"已有账号？返回登录":"没有账号？使用产品注册码注册"})}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"text-xs text-gray-500 mt-4",children:"测试账号: test@example.com / 密码: test123456"})})]})]})]})})};export{X as default};
//# sourceMappingURL=Login-9CXt6lGv.js.map
