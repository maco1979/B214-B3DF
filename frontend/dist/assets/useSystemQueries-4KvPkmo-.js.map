{"version":3,"file":"useSystemQueries-4KvPkmo-.js","sources":["../../src/hooks/useSystemQueries.ts"],"sourcesContent":["import { useQuery } from '@tanstack/react-query'\r\nimport { http } from '@/lib/api-client'\r\nimport { ApiResponse, SystemMetrics, BlockchainStatus, Device } from '@/services/api'\r\nimport { useEventSource } from './useEventSource'\r\n\r\ntype QueryTimingOptions = {\r\n  staleTime?: number\r\n  refetchInterval?: number | false\r\n}\r\n\r\nexport function useSystemMetricsQuery(options: QueryTimingOptions = {}) {\r\n  return useQuery({\r\n    queryKey: ['system-metrics'],\r\n    queryFn: async () => {\r\n      const res = await http.get('/api/system/metrics') as unknown as ApiResponse<SystemMetrics>\r\n      if (!res.success) throw new Error(res.error || '获取系统指标失败')\r\n      return res.data\r\n    },\r\n    staleTime: options.staleTime ?? 30_000,\r\n    refetchInterval: options.refetchInterval ?? 60_000,\r\n  })\r\n}\r\n\r\nexport function usePerformanceSummaryQuery(options: QueryTimingOptions = {}) {\r\n  return useQuery({\r\n    queryKey: ['performance-summary'],\r\n    queryFn: async () => {\r\n      const res = await http.get('/api/performance/summary') as unknown as ApiResponse<any>\r\n      if (!res.success) throw new Error(res.error || '获取性能概览失败')\r\n      return res.data\r\n    },\r\n    staleTime: options.staleTime ?? 30_000,\r\n    refetchInterval: options.refetchInterval ?? 60_000,\r\n  })\r\n}\r\n\r\nexport function usePerformanceMetricsQuery(options: QueryTimingOptions = {}) {\r\n  return useQuery({\r\n    queryKey: ['performance-metrics'],\r\n    queryFn: async () => {\r\n      const res = await http.get('/api/performance/summary') as unknown as ApiResponse<any>\r\n      if (!res.success) throw new Error(res.error || '获取性能指标失败')\r\n      return res.data\r\n    },\r\n    staleTime: options.staleTime ?? 10_000,\r\n    refetchInterval: options.refetchInterval ?? 20_000,\r\n  })\r\n}\r\n\r\nexport function useOptimizationStatusQuery(options: QueryTimingOptions = {}) {\r\n  return useQuery({\r\n    queryKey: ['optimization-status'],\r\n    queryFn: async () => {\r\n      const res = await http.get('/api/performance/optimization/status') as unknown as ApiResponse<any>\r\n      if (!res.success) throw new Error(res.error || '获取优化状态失败')\r\n      return res.data\r\n    },\r\n    staleTime: options.staleTime ?? 30_000,\r\n    refetchInterval: options.refetchInterval ?? 60_000,\r\n  })\r\n}\r\n\r\nexport function useBlockchainStatusQuery(options: QueryTimingOptions = {}) {\r\n  return useQuery({\r\n    queryKey: ['blockchain-status'],\r\n    queryFn: async () => {\r\n      const res = await http.get('/api/blockchain/status') as unknown as ApiResponse<BlockchainStatus>\r\n      if (!res.success) throw new Error(res.error || '获取区块链状态失败')\r\n      return res.data\r\n    },\r\n    staleTime: options.staleTime ?? 60_000,\r\n    refetchInterval: options.refetchInterval,\r\n  })\r\n}\r\n\r\nexport function useEdgeDevicesQuery(options: QueryTimingOptions = {}) {\r\n  return useQuery({\r\n    queryKey: ['edge-devices'],\r\n    queryFn: async () => {\r\n      const res = await http.get('/api/edge/devices') as unknown as ApiResponse<any[]>\r\n      if (!res.success) throw new Error(res.error || '获取设备列表失败')\r\n      return res.data || []\r\n    },\r\n    staleTime: options.staleTime ?? 5_000,\r\n    refetchInterval: options.refetchInterval ?? 10_000,\r\n  })\r\n}\r\n\r\nexport function useInferenceHistoryQuery(options: QueryTimingOptions = {}) {\r\n  return useQuery({\r\n    queryKey: ['inference-history'],\r\n    queryFn: async () => {\r\n      // 后端不存在该API，直接返回空数据\r\n      return []\r\n    },\r\n    staleTime: options.staleTime ?? 30_000,\r\n    refetchInterval: options.refetchInterval ?? false,\r\n  })\r\n}\r\n\r\nexport function useSystemMetricsRealtime(options?: { enabled?: boolean }) {\r\n  // 移除SSE流请求，直接使用普通查询\r\n  const query = useSystemMetricsQuery({ \r\n    refetchInterval: options?.enabled ? 10_000 : false \r\n  })\r\n\r\n  return query\r\n}\r\n\r\nexport function useInferenceHistoryRealtime(options?: { enabled?: boolean; keepLast?: number }) {\r\n  // 移除SSE流请求，直接使用普通查询\r\n  const query = useInferenceHistoryQuery({ \r\n    refetchInterval: options?.enabled ? 15_000 : false \r\n  })\r\n\r\n  return query\r\n}\r\n"],"names":["useSystemMetricsQuery","options","useQuery","res","http","usePerformanceMetricsQuery","useOptimizationStatusQuery","useBlockchainStatusQuery","useEdgeDevicesQuery","useSystemMetricsRealtime"],"mappings":"mFAUO,SAASA,EAAsBC,EAA8B,GAAI,CACtE,OAAOC,EAAS,CACd,SAAU,CAAC,gBAAgB,EAC3B,QAAS,SAAY,CACnB,MAAMC,EAAM,MAAMC,EAAK,IAAI,qBAAqB,EAChD,GAAI,CAACD,EAAI,QAAS,MAAM,IAAI,MAAMA,EAAI,OAAS,UAAU,EACzD,OAAOA,EAAI,IACb,EACA,UAAWF,EAAQ,WAAa,IAChC,gBAAiBA,EAAQ,iBAAmB,GAAA,CAC7C,CACH,CAeO,SAASI,EAA2BJ,EAA8B,GAAI,CAC3E,OAAOC,EAAS,CACd,SAAU,CAAC,qBAAqB,EAChC,QAAS,SAAY,CACnB,MAAMC,EAAM,MAAMC,EAAK,IAAI,0BAA0B,EACrD,GAAI,CAACD,EAAI,QAAS,MAAM,IAAI,MAAMA,EAAI,OAAS,UAAU,EACzD,OAAOA,EAAI,IACb,EACA,UAAWF,EAAQ,WAAa,IAChC,gBAAiBA,EAAQ,iBAAmB,GAAA,CAC7C,CACH,CAEO,SAASK,EAA2BL,EAA8B,GAAI,CAC3E,OAAOC,EAAS,CACd,SAAU,CAAC,qBAAqB,EAChC,QAAS,SAAY,CACnB,MAAMC,EAAM,MAAMC,EAAK,IAAI,sCAAsC,EACjE,GAAI,CAACD,EAAI,QAAS,MAAM,IAAI,MAAMA,EAAI,OAAS,UAAU,EACzD,OAAOA,EAAI,IACb,EACA,UAAWF,EAAQ,WAAa,IAChC,gBAAiBA,EAAQ,iBAAmB,GAAA,CAC7C,CACH,CAEO,SAASM,EAAyBN,EAA8B,GAAI,CACzE,OAAOC,EAAS,CACd,SAAU,CAAC,mBAAmB,EAC9B,QAAS,SAAY,CACnB,MAAMC,EAAM,MAAMC,EAAK,IAAI,wBAAwB,EACnD,GAAI,CAACD,EAAI,QAAS,MAAM,IAAI,MAAMA,EAAI,OAAS,WAAW,EAC1D,OAAOA,EAAI,IACb,EACA,UAAWF,EAAQ,WAAa,IAChC,gBAAiBA,EAAQ,eAAA,CAC1B,CACH,CAEO,SAASO,EAAoBP,EAA8B,GAAI,CACpE,OAAOC,EAAS,CACd,SAAU,CAAC,cAAc,EACzB,QAAS,SAAY,CACnB,MAAMC,EAAM,MAAMC,EAAK,IAAI,mBAAmB,EAC9C,GAAI,CAACD,EAAI,QAAS,MAAM,IAAI,MAAMA,EAAI,OAAS,UAAU,EACzD,OAAOA,EAAI,MAAQ,CAAA,CACrB,EACA,UAAWF,EAAQ,WAAa,IAChC,gBAAiBA,EAAQ,iBAAmB,GAAA,CAC7C,CACH,CAcO,SAASQ,EAAyBR,EAAiC,CAMxE,OAJcD,EAAsB,CAClC,gBAA6C,EAAA,CAC9C,CAGH"}