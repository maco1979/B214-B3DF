import{r as l,S as P,e as $,j as e,f as d,v as z,w as H,d as r}from"./index-yVhfAtPc.js";import{C as o,a as m,b as h,d as p,c as u}from"./card-fvSyAV1p.js";import{I as x}from"./input-BRuGLdy_.js";import{U as I}from"./users-DqIhfcId.js";import{T as q}from"./trending-up-BWoRqqDA.js";import{R as G}from"./refresh-cw-a_RgfZ6I.js";import{P as J}from"./plus-Duh8WK98.js";import{P as K}from"./play-DJ2Vx5IY.js";function ee(){var C,_,F;const[f,k]=l.useState([]),[D,A]=l.useState([]),[t,S]=l.useState(null),[a,L]=l.useState(null),[v,b]=l.useState(!0),[g,w]=l.useState(""),[n,N]=l.useState({client_fraction:.5,learning_rate:.01,epochs:10}),i=async()=>{try{b(!0);const[s,c,j,R]=await Promise.all([r.getFederatedClients(),r.getFederatedRounds(),r.getFederatedPrivacyStatus(),r.getFederatedStatus()]);s.success&&k(Array.isArray(s.data)?s.data:[]),c.success&&A(Array.isArray(c.data)?c.data:[]),j.success&&S(j.data),R.success&&L(R.data)}catch(s){console.error("获取联邦学习数据失败:",s)}finally{b(!1)}};l.useEffect(()=>{i()},[]);const T=async()=>{if(g.trim())try{(await r.registerFederatedClient({client_id:g,device_type:"edge_device",capabilities:["training","inference"]})).success&&(w(""),i())}catch(s){console.error("注册客户端失败:",s)}},E=async()=>{try{(await r.startFederatedRound(n)).success&&i()}catch(s){console.error("启动训练轮次失败:",s)}},U=async s=>{try{(await r.aggregateFederatedRound(s)).success&&i()}catch(c){console.error("聚合轮次失败:",c)}},y=async s=>{try{(await r.updateFederatedPrivacyConfig(s)).success&&i()}catch(c){console.error("更新隐私配置失败:",c)}},B=[{label:"注册客户端",value:(a==null?void 0:a.total_clients)||0,icon:I,color:"text-blue-400",change:`活跃: ${(a==null?void 0:a.active_clients)||0}`},{label:"完成轮次",value:(a==null?void 0:a.rounds_completed)||0,icon:q,color:"text-green-400",change:"持续训练中"},{label:"隐私保护",value:t!=null&&t.enabled?"启用":"禁用",icon:P,color:"text-purple-400",change:`ε=${(t==null?void 0:t.epsilon)||0}`},{label:"当前轮次",value:a!=null&&a.current_round?"进行中":"未开始",icon:$,color:"text-yellow-400",change:(C=a==null?void 0:a.current_round)!=null&&C.participants_count?`${a.current_round.participants_count}客户端`:"--"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold gradient-text mb-2",children:"联邦学习系统"}),e.jsx("p",{className:"text-gray-300",children:"分布式AI训练，保护数据隐私，实现协同学习"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(d,{variant:"outline",onClick:i,disabled:v,className:"flex items-center space-x-2",children:[e.jsx(G,{className:`w-4 h-4 ${v?"animate-spin":""}`}),e.jsx("span",{children:"刷新"})]}),e.jsxs(d,{variant:"tech",className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{children:"系统设置"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:B.map((s,c)=>{const j=s.icon;return e.jsxs(o,{className:"glass-effect hover:neon-glow transition-all duration-300",children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-gray-400",children:s.label}),e.jsx(j,{className:`w-4 h-4 ${s.color}`})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:s.value}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:s.change})]})]},c)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(o,{className:"glass-effect",children:[e.jsxs(m,{children:[e.jsxs(h,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{className:"w-5 h-5 text-tech-primary"}),e.jsx("span",{children:"客户端管理"})]}),e.jsxs("span",{className:"text-sm text-gray-400",children:[f.length," 客户端"]})]}),e.jsx(u,{children:"注册和管理联邦学习客户端"})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(x,{placeholder:"输入客户端ID",value:g,onChange:s=>w(s.target.value),className:"flex-1"}),e.jsxs(d,{variant:"tech",onClick:T,disabled:!g.trim(),className:"flex items-center space-x-2",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{children:"注册"})]})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:f.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-tech-dark/30 rounded",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:s.client_id}),e.jsxs("div",{className:"text-xs text-gray-400",children:["注册时间: ",new Date(s.registered_at).toLocaleDateString()]})]}),e.jsx("div",{className:`text-xs px-2 py-1 rounded ${s.status==="active"?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"}`,children:s.status==="active"?"活跃":"离线"})]},s.client_id))})]})]}),e.jsxs(o,{className:"glass-effect",children:[e.jsxs(m,{children:[e.jsxs(h,{className:"flex items-center space-x-2",children:[e.jsx($,{className:"w-5 h-5 text-tech-primary"}),e.jsx("span",{children:"训练控制"})]}),e.jsx(u,{children:"配置和启动联邦学习轮次"})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"客户端比例"}),e.jsx(x,{type:"number",min:"0.1",max:"1.0",step:"0.1",value:n.client_fraction,onChange:s=>N({...n,client_fraction:parseFloat(s.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"学习率"}),e.jsx(x,{type:"number",min:"0.001",max:"0.1",step:"0.001",value:n.learning_rate,onChange:s=>N({...n,learning_rate:parseFloat(s.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400",children:"训练轮数"}),e.jsx(x,{type:"number",min:"1",max:"100",value:n.epochs,onChange:s=>N({...n,epochs:parseInt(s.target.value)})})]})]}),e.jsxs(d,{variant:"tech",onClick:E,disabled:f.length===0,className:"w-full flex items-center space-x-2",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:"启动训练轮次"})]})]})]})]}),e.jsxs(o,{className:"glass-effect",children:[e.jsxs(m,{children:[e.jsxs(h,{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-5 h-5 text-tech-primary"}),e.jsx("span",{children:"训练历史"})]}),e.jsx(u,{children:"联邦学习训练轮次记录"})]}),e.jsx(p,{children:e.jsx("div",{className:"space-y-3",children:D.slice().reverse().map((s,c)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-tech-dark/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${s.status==="completed"?"bg-green-400":s.status==="active"?"bg-yellow-400":"bg-gray-400"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:s.round_id}),e.jsxs("div",{className:"text-sm text-gray-400",children:["开始时间: ",new Date(s.start_time).toLocaleString()]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-400",children:[s.participants_count||s.participants&&s.participants.length||0," 客户端参与"]}),s.status==="active"&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>U(s.round_id),children:"聚合"})]})]},`${s.round_id}_${c}`))})})]}),t&&e.jsxs(o,{className:"glass-effect",children:[e.jsxs(m,{children:[e.jsxs(h,{className:"flex items-center space-x-2",children:[e.jsx(P,{className:"w-5 h-5 text-purple-400"}),e.jsx("span",{children:"差分隐私保护"})]}),e.jsx(u,{children:"配置隐私保护参数，平衡隐私和模型性能"})]}),e.jsx(p,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"隐私预算 (ε)"}),e.jsx(x,{type:"number",min:"0.1",max:"10.0",step:"0.1",value:t.epsilon,onChange:s=>y({epsilon:parseFloat(s.target.value)})}),e.jsx("div",{className:"text-xs text-gray-400",children:"值越小，隐私保护越强"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"失败概率 (δ)"}),e.jsx(x,{type:"number",min:"1e-6",max:"1e-3",step:"1e-6",value:t.delta,onChange:s=>y({delta:parseFloat(s.target.value)})}),e.jsx("div",{className:"text-xs text-gray-400",children:"通常设置为很小的值"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"隐私保护"}),e.jsx(d,{variant:t.enabled?"tech":"outline",onClick:()=>y({enabled:!t.enabled}),className:"w-full",children:t.enabled?"已启用":"已禁用"}),e.jsxs("div",{className:"text-xs text-gray-400",children:["已消耗隐私: ",((F=(_=t.privacy_spent)==null?void 0:_.epsilon_spent)==null?void 0:F.toFixed(3))||"0.000"]})]})]})})]})]})}export{ee as FederatedLearning};
//# sourceMappingURL=FederatedLearning-chE5ANv_.js.map
